<svg xmlns="http://www.w3.org/2000/svg" id="mermaidChart359" width="100%" height="100%" viewBox="-160 -10 1819.5 1605" style="max-width:1819.5px"><style title="mermaid-svg-internal-css" type="text/css">*,::after,::before{box-sizing:inherit}.messageText,text.actor{font-size:12px}#arrowhead{fill:#333}text.actor{fill:#000;stroke:none}.actor{stroke:#ccf;fill:#ececff}.actor-line{stroke:gray}.messageLine0,.messageLine1{stroke-width:1.5;stroke:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#ccf;fill:#ececff}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke:#ccf}.note{stroke:#aa3;fill:#fff5ad}.noteText{fill:#000;stroke:none}.noteText,text{font-family:&quot;trebuchet ms&quot;,verdana,arial;font-size:14px}</style><g><line id="actor2907" x1="75" x2="75" y1="5" y2="1594" stroke="#999" stroke-width=".5" class="actor-line"/><rect width="150" height="65" x="0" y="0" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="75" y="37.5" class="actor" text-anchor="middle">Root CA</text></g><g><line id="actor2908" x1="275" x2="275" y1="5" y2="1594" stroke="#999" stroke-width=".5" class="actor-line"/><rect width="150" height="65" x="200" y="0" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="275" y="37.5" class="actor" text-anchor="middle">HSM</text></g><g><line id="actor2909" x1="475" x2="475" y1="5" y2="1594" stroke="#999" stroke-width=".5" class="actor-line"/><rect width="150" height="65" x="400" y="0" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="475" y="37.5" class="actor" text-anchor="middle">Autograph</text></g><g><line id="actor2910" x1="675" x2="675" y1="5" y2="1594" stroke="#999" stroke-width=".5" class="actor-line"/><rect width="150" height="65" x="600" y="0" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="675" y="37.5" class="actor" text-anchor="middle">Service Admin</text></g><g><line id="actor2911" x1="875" x2="875" y1="5" y2="1594" stroke="#999" stroke-width=".5" class="actor-line"/><rect width="150" height="65" x="800" y="0" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="875" y="37.5" class="actor" text-anchor="middle">Service DB</text></g><g><line id="actor2912" x1="1075" x2="1075" y1="5" y2="1594" stroke="#999" stroke-width=".5" class="actor-line"/><rect width="150" height="65" x="1000" y="0" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="1075" y="37.5" class="actor" text-anchor="middle">Service Endpoint</text></g><g><line id="actor2913" x1="1275" x2="1275" y1="5" y2="1594" stroke="#999" stroke-width=".5" class="actor-line"/><rect width="150" height="65" x="1200" y="0" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="1275" y="37.5" class="actor" text-anchor="middle">CDN</text></g><g><line id="actor2914" x1="1475" x2="1475" y1="5" y2="1594" stroke="#999" stroke-width=".5" class="actor-line"/><rect width="150" height="65" x="1400" y="0" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="1475" y="37.5" class="actor" text-anchor="middle">Firefox</text></g><defs><marker id="arrowhead" markerHeight="4" markerWidth="6" orient="auto" refX="5" refY="2"><path d="M 0,0 V 4 L6,2 Z"/></marker></defs><defs><marker id="crosshead" markerHeight="8" markerWidth="15" orient="auto" refX="16" refY="4"><path fill="#000" stroke="#000" stroke-dasharray="0 0" stroke-width="1" d="M 9,2 V 6 L16,4 Z"/><path fill="none" stroke="#000" stroke-dasharray="0 0" stroke-width="1" d="M 0,1 L 6,7 M 6,1 L 0,7"/></marker></defs><g><text x="75" y="118" class="messageText" text-anchor="middle">make key pair, store privkey offline</text><path fill="none" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" d="M 75,125 C 135,115 135,155 75,145" class="messageLine0"/></g><g><rect width="150" height="36" x="-100" y="165" fill="#EDF2AE" stroke="#666" class="note" rx="0" ry="0"/><text x="-84" y="193" fill="#000" class="noteText"><tspan x="-84">Ca, ttl=10years</tspan></text></g><g><text x="275" y="229" class="messageText" text-anchor="middle">make key pair, store privkey in hsm</text><path fill="none" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" d="M 275,236 C 335,226 335,266 275,256" class="messageLine0"/></g><g><text x="175" y="294" class="messageText" text-anchor="middle">get signed intermediate cert Ci</text><line x1="275" x2="75" y1="301" y2="301" fill="none" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine0"/></g><g><text x="175" y="329" class="messageText" text-anchor="middle">Ci</text><line x1="75" x2="275" y1="336" y2="336" fill="none" stroke="#000" stroke-dasharray="3 3" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine1"/></g><g><rect width="150" height="36" x="100" y="346" fill="#EDF2AE" stroke="#666" class="note" rx="0" ry="0"/><text x="116" y="374" fill="#000" class="noteText"><tspan x="116">Ci, ttl=2years</tspan></text></g><g><text x="475" y="410" class="messageText" text-anchor="middle">make key pair on server</text><path fill="none" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" d="M 475,417 C 535,407 535,447 475,437" class="messageLine0"/></g><g><text x="375" y="475" class="messageText" text-anchor="middle">get signed end-entity cert Cee</text><line x1="475" x2="275" y1="482" y2="482" fill="none" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine0"/></g><g><text x="375" y="510" class="messageText" text-anchor="middle">Cee</text><line x1="275" x2="475" y1="517" y2="517" fill="none" stroke="#000" stroke-dasharray="3 3" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine1"/></g><g><rect width="150" height="36" x="300" y="527" fill="#EDF2AE" stroke="#666" class="note" rx="0" ry="0"/><text x="316" y="555" fill="#000" class="noteText"><tspan x="316">Cee, ttl=45days</tspan></text></g><g><text x="875" y="591" class="messageText" text-anchor="middle">publish chain of trust Cee+Ci+Ca at location x5u</text><line x1="475" x2="1275" y1="598" y2="598" fill="none" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine0"/></g><g><rect width="150" height="36" x="1100" y="608" fill="#EDF2AE" stroke="#666" class="note" rx="0" ry="0"/><text x="1116" y="636" fill="#000" class="noteText"><tspan x="1116">Cee+Ci+Ca</tspan></text></g><g><line x1="-110" x2="1285" y1="75" y2="75" stroke="#526e52" stroke-width="2" class="loopLine"/><line x1="1285" x2="1285" y1="75" y2="654" stroke="#526e52" stroke-width="2" class="loopLine"/><line x1="-110" x2="1285" y1="654" y2="654" stroke="#526e52" stroke-width="2" class="loopLine"/><line x1="-110" x2="-110" y1="75" y2="654" stroke="#526e52" stroke-width="2" class="loopLine"/><rect width="50" height="20" x="-110" y="75" fill="#526e52" stroke="none" class="labelBox" rx="0" ry="0"/><text x="-102.5" y="90" fill="#fff" class="labelText"><tspan x="-102.5">opt</tspan></text><text x="587.5" y="90" fill="#000" class="loopText" text-anchor="middle"><tspan x="587.5">[ Chain of Trust Issuance ]</tspan></text></g><g><text x="575" y="707" class="messageText" text-anchor="middle">POST /sign/data</text><line x1="675" x2="475" y1="714" y2="714" fill="none" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine0"/></g><g><text x="575" y="742" class="messageText" text-anchor="middle">Content-Signature</text><line x1="475" x2="675" y1="749" y2="749" fill="none" stroke="#000" stroke-dasharray="3 3" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine1"/></g><g><text x="775" y="777" class="messageText" text-anchor="middle">insert Data+Content-Signature</text><line x1="675" x2="875" y1="784" y2="784" fill="none" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine0"/></g><g><rect width="150" height="57" x="700" y="794" fill="#EDF2AE" stroke="#666" class="note" rx="0" ry="0"/><text x="716" y="822" fill="#000" class="noteText"><tspan x="716">Data +</tspan><tspan x="716" dy="21">Content-Signature</tspan></text></g><g><text x="1275" y="879" class="messageText" text-anchor="middle">get /data</text><line x1="1475" x2="1075" y1="886" y2="886" fill="none" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine0"/></g><g><text x="975" y="914" class="messageText" text-anchor="middle">select data</text><line x1="1075" x2="875" y1="921" y2="921" fill="none" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine0"/></g><g><text x="1275" y="949" class="messageText" text-anchor="middle">Data + Content-Signature</text><line x1="1075" x2="1475" y1="956" y2="956" fill="none" stroke="#000" stroke-dasharray="3 3" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine1"/></g><g><rect width="150" height="57" x="1300" y="966" fill="#EDF2AE" stroke="#666" class="note" rx="0" ry="0"/><text x="1316" y="994" fill="#000" class="noteText"><tspan x="1316">Data +</tspan><tspan x="1316" dy="21">Content-Signature</tspan></text></g><g><line x1="465" x2="1485" y1="664" y2="664" stroke="#526e52" stroke-width="2" class="loopLine"/><line x1="1485" x2="1485" y1="664" y2="1033" stroke="#526e52" stroke-width="2" class="loopLine"/><line x1="465" x2="1485" y1="1033" y2="1033" stroke="#526e52" stroke-width="2" class="loopLine"/><line x1="465" x2="465" y1="664" y2="1033" stroke="#526e52" stroke-width="2" class="loopLine"/><rect width="50" height="20" x="465" y="664" fill="#526e52" stroke="none" class="labelBox" rx="0" ry="0"/><text x="472.5" y="679" fill="#fff" class="labelText"><tspan x="472.5">opt</tspan></text><text x="975" y="679" fill="#000" class="loopText" text-anchor="middle"><tspan x="975">[ Signature Issuance ]</tspan></text></g><g><text x="1475" y="1086" class="messageText" text-anchor="middle">check http cache for x5u</text><path fill="none" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" d="M 1475,1093 C 1535,1083 1535,1123 1475,1113" class="messageLine0"/></g><g><text x="1375" y="1151" class="messageText" text-anchor="middle">if not in cache, get x5u</text><line x1="1475" x2="1275" y1="1158" y2="1158" fill="none" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine0"/></g><g><text x="1375" y="1186" class="messageText" text-anchor="middle">Cee+Ci+Ca</text><line x1="1275" x2="1475" y1="1193" y2="1193" fill="none" stroke="#000" stroke-dasharray="3 3" stroke-width="2" marker-end="url(#arrowhead)" class="messageLine1"/></g><g><rect width="150" height="36" x="1300" y="1203" fill="#EDF2AE" stroke="#666" class="note" rx="0" ry="0"/><text x="1316" y="1231" fill="#000" class="noteText"><tspan x="1316">Cee+Ci+Ca</tspan></text></g><g><text x="1475" y="1267" class="messageText" text-anchor="middle">Verify Content-Signature using Cee</text><path fill="none" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" d="M 1475,1274 C 1535,1264 1535,1304 1475,1294" class="messageLine0"/></g><g><text x="1475" y="1332" class="messageText" text-anchor="middle">Verify chain of trust Cee+Ci+Ca</text><path fill="none" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" d="M 1475,1339 C 1535,1329 1535,1369 1475,1359" class="messageLine0"/></g><g><text x="1475" y="1397" class="messageText" text-anchor="middle">Verify public key hash of Ca with configuration</text><path fill="none" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" d="M 1475,1404 C 1535,1394 1535,1434 1475,1424" class="messageLine0"/></g><g><text x="1475" y="1462" class="messageText" text-anchor="middle">pass Data to next step</text><path fill="none" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)" d="M 1475,1469 C 1535,1459 1535,1499 1475,1489" class="messageLine0"/></g><g><line x1="1265" x2="1609.5" y1="1043" y2="1043" stroke="#526e52" stroke-width="2" class="loopLine"/><line x1="1609.5" x2="1609.5" y1="1043" y2="1509" stroke="#526e52" stroke-width="2" class="loopLine"/><line x1="1265" x2="1609.5" y1="1509" y2="1509" stroke="#526e52" stroke-width="2" class="loopLine"/><line x1="1265" x2="1265" y1="1043" y2="1509" stroke="#526e52" stroke-width="2" class="loopLine"/><rect width="50" height="20" x="1265" y="1043" fill="#526e52" stroke="none" class="labelBox" rx="0" ry="0"/><text x="1272.5" y="1058" fill="#fff" class="labelText"><tspan x="1272.5">opt</tspan></text><text x="1437.25" y="1058" fill="#000" class="loopText" text-anchor="middle"><tspan x="1437.25">[ Signature verification ]</tspan></text></g><g><rect width="150" height="65" x="0" y="1529" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="75" y="1566.5" class="actor" text-anchor="middle">Root CA</text></g><g><rect width="150" height="65" x="200" y="1529" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="275" y="1566.5" class="actor" text-anchor="middle">HSM</text></g><g><rect width="150" height="65" x="400" y="1529" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="475" y="1566.5" class="actor" text-anchor="middle">Autograph</text></g><g><rect width="150" height="65" x="600" y="1529" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="675" y="1566.5" class="actor" text-anchor="middle">Service Admin</text></g><g><rect width="150" height="65" x="800" y="1529" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="875" y="1566.5" class="actor" text-anchor="middle">Service DB</text></g><g><rect width="150" height="65" x="1000" y="1529" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="1075" y="1566.5" class="actor" text-anchor="middle">Service Endpoint</text></g><g><rect width="150" height="65" x="1200" y="1529" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="1275" y="1566.5" class="actor" text-anchor="middle">CDN</text></g><g><rect width="150" height="65" x="1400" y="1529" fill="#eaeaea" stroke="#666" class="actor" rx="3" ry="3"/><text x="1475" y="1566.5" class="actor" text-anchor="middle">Firefox</text></g></svg>